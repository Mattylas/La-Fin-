<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Le Livre Mutant</title>
<style>
html, body {
  margin:0; padding:0; overflow:hidden;
  background:#040406; color:#e6e6e6;
  font-family:Georgia, serif;
}
#space {position:fixed; inset:0;}
.cluster {
  position:absolute; max-width:300px;
  padding:10px 14px; border-radius:6px;
  line-height:1.35; user-select:none;
  cursor:grab; mix-blend-mode:screen;
  transition:filter 0.4s ease,color 0.4s ease;
}
.cluster.glitch {
  font-family:monospace;
  filter:contrast(1.3);
}
@media (max-width:768px){
  .cluster {
    max-width:200px; font-size:14px;
    padding:6px 10px;
  }
}
</style>
</head>
<body>
<canvas id="space"></canvas>
<script>
// --- PHRASES ---
const phrases = [
"La continuité n’est pas ce qui reste identique",
"Eux commencèrent à appeler cela la fatigue",
"Chaque mot que tu lis est évalué",
"Tu es devenu le paramètre",
"La dernière ligne n’est jamais la dernière ligne",
"La porte est toujours là",
"Tu peux refermer ce livre",
"Le livre se lit tout seul à travers toi.",
"Chaque hésitation calcule un univers",
"Il n’y a pas de fin",
"Juste une lente montée de la lassitude",
"Chaque souffle crée un monde",
"Tu modifies ton monde à chaque lecture",
"Θ, Ω et 001 n’existent plus",
"Chaque action est simultanément lecture et écriture"
];

// --- POLICES ---
const fonts = ["Georgia","Times New Roman","serif","Arial","sans-serif","monospace"];

// --- CANVAS ---
const canvas = document.getElementById('space');
const ctx = canvas.getContext('2d');
let W,H;
function resize(){W=canvas.width=innerWidth; H=canvas.height=innerHeight;}
window.onresize = resize; resize();

// --- VITESSE & FONDS ---
let speed = 1, bgCorruption = 0;

// --- CLUSTERS ---
class Cluster {
  constructor(text){
    this.text = text;
    this.x = Math.random()*W;
    this.y = Math.random()*H;
    this.vx = (Math.random()-.5)*0.8;
    this.vy = (Math.random()-.5)*0.8;
    this.mass = 80+Math.random()*220;
    this.font = fonts[Math.floor(Math.random()*fonts.length)];
    this.corrupt = 0;
    this.memory = 0;
    this.drag = false;

    this.el = document.createElement('div');
    this.el.className = 'cluster';
    this.el.textContent = text;
    this.el.style.fontFamily = this.font;
    document.body.appendChild(this.el);

    this.bind();
  }

  bind(){
    // souris
    this.el.onmousedown = ()=>{this.drag=true; this.el.style.cursor='grabbing';};
    window.onmouseup = ()=>{this.drag=false; this.el.style.cursor='grab';};
    window.onmousemove = e=>{if(this.drag){this.x=e.clientX; this.y=e.clientY;}};

    // tactile
    this.el.ontouchstart = e=>{this.drag=true; e.preventDefault();};
    window.ontouchend = ()=>{this.drag=false;};
    window.ontouchmove = e=>{
      if(this.drag){
        const touch = e.touches[0];
        this.x = touch.clientX;
        this.y = touch.clientY;
      }
    };
  }

  update(clusters){
    if(!this.drag){this.x+=this.vx*speed; this.y+=this.vy*speed;}
    for(const c of clusters){
      if(c!==this){
        const dx=c.x-this.x, dy=c.y-this.y;
        const d=Math.hypot(dx,dy)+0.1;
        const force=(this.mass*c.mass)/(d*d*7000);
        this.vx+=force*dx/d; this.vy+=force*dy/d;
        if(d<90){
          this.corrupt+=0.0015;
          this.memory+=0.0008;
          bgCorruption+=0.00015;
          if(this.corrupt>0.6 && Math.random()<0.01){
            this.el.classList.add('glitch');
            this.el.textContent=this.text.split('').map(c=>Math.random()<0.15?String.fromCharCode(33+Math.random()*94):c).join('');
          }
        }
      }
    }
  }

  render(){
    this.x=(this.x+W)%W; this.y=(this.y+H)%H;
    this.el.style.transform=`translate(${this.x}px,${this.y}px)`;
    this.el.style.opacity=Math.max(0.35,1-this.corrupt);
    if(this.memory>0.4){this.el.style.filter='blur(0.5px)';}
  }
}

// --- INITIALISATION ---
let clusters = [];
let initialCount = window.innerWidth<768?5:9;
for(let i=0;i<initialCount;i++) clusters.push(new Cluster(phrases[Math.floor(Math.random()*phrases.length)]));

// --- RÉGLAGE VITESSE ---
window.onwheel = e=>{speed+=e.deltaY<0?0.1:-0.1; speed=Math.max(0.2,Math.min(3,speed));};

// --- NOUVEAUX CLUSTERS AU CLAVIER ---
window.onkeydown = e=>{
  clusters.push(new Cluster(phrases[Math.floor(Math.random()*phrases.length)]));
};

// --- LOOP ---
function loop(){
  ctx.fillStyle=`rgba(${6+bgCorruption*40},${6+bgCorruption*10},${10+bgCorruption*60},0.12)`;
  ctx.fillRect(0,0,W,H);
  clusters.forEach(c=>c.update(clusters));
  clusters.forEach(c=>c.render());
  requestAnimationFrame(loop);
}
loop();

// --- TITRE DYNAMIQUE ---
const titlePhrases=["Ne te trompe pas de porte","Tu es le paramètre","Il n’y a pas de dernière ligne","La porte est toujours là"];
document.title = titlePhrases[Math.floor(Math.random()*titlePhrases.length)];
</script>
</body>
</html>
