<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Le Livre Mutant</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#040406;color:#e6e6e6;font-size:16px;}
#space{position:fixed;inset:0}
.cluster{
  position:absolute;
  max-width:320px;
  padding:10px 14px;
  border-radius:6px;
  line-height:1.35;
  user-select:none;
  cursor:grab;
  mix-blend-mode:screen;
  transition:filter 0.4s ease,color 0.4s ease,opacity 0.4s ease,transform 0.2s ease;
}
.cluster.glitch{
  font-family:monospace;
  filter:contrast(1.5) blur(0.5px);
}
</style>
</head>
<body>
<canvas id="space"></canvas>
<script src="phrases.js"></script>
<script>
// --- FONTS ---
const fonts=["Georgia","Times New Roman","serif","Arial","sans-serif","monospace"];

// --- CANVAS ---
const canvas=document.getElementById('space');
const ctx=canvas.getContext('2d');
let W,H;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
window.onresize=resize;resize();

// --- PARAMS ---
let speed=1, bgCorruption=0;

// --- CLUSTER CLASS ---
class Cluster{
  constructor(text){
    this.text=text;
    this.x=Math.random()*W;
    this.y=Math.random()*H;
    this.vx=(Math.random()-.5)*0.8;
    this.vy=(Math.random()-.5)*0.8;
    this.mass=80+Math.random()*220;
    this.font=fonts[Math.floor(Math.random()*fonts.length)];
    this.corrupt=0;
    this.memory=0;
    this.drag=false;
    this.unique=Math.random(); // variation unique

    this.el=document.createElement('div');
    this.el.className='cluster';
    this.el.textContent=text;
    this.el.style.fontFamily=this.font;
    document.body.appendChild(this.el);

    this.bind();
  }

  bind(){
    this.el.onmousedown=()=>{this.drag=true; this.el.style.cursor='grabbing';};
    window.onmouseup=()=>{this.drag=false; this.el.style.cursor='grab';};
    window.onmousemove=e=>{if(this.drag){this.x=e.clientX; this.y=e.clientY;}}
  }

  update(clusters){
    if(!this.drag){this.x+=this.vx*speed; this.y+=this.vy*speed;}
    for(const c of clusters){
      if(c!==this){
        const dx=c.x-this.x, dy=c.y-this.y;
        const d=Math.hypot(dx,dy)+0.1;
        const force=(this.mass*c.mass)/(d*d*7000);
        // Astres : attraction/répulsion
        this.vx+=force*dx/d*(Math.random()*0.6+0.7);
        this.vy+=force*dy/d*(Math.random()*0.6+0.7);

        // Interactions à courte distance
        if(d<100){
          // corruption
          this.corrupt+=0.0015;
          this.memory+=0.0008;
          bgCorruption+=0.00008;
          // fusion/glitch aléatoire
          if(Math.random()<0.002){
            if(Math.random()<0.5){
              c.text=this.text; // fusion
            } else {
              c.el.classList.add('glitch');
              c.el.textContent=this.text.split('').map(ch=>Math.random()<0.15?String.fromCharCode(33+Math.random()*94):ch).join('');
            }
          }
        }
      }
    }
  }

  render(){
    this.x=(this.x+W)%W; this.y=(this.y+H)%H;
    this.el.style.transform=`translate(${this.x}px,${this.y}px)`;
    this.el.style.opacity=Math.max(0.35,1-this.corrupt);
    if(this.memory>0.4){this.el.style.filter='blur(0.5px)';}
  }
}

// --- CLUSTERS INIT ---
let clusters=[];
for(let i=0;i<12;i++) clusters.push(new Cluster(phrases[Math.floor(Math.random()*phrases.length)]));

// --- EVENTS ---
window.onwheel=e=>{speed+=e.deltaY<0?0.1:-0.1; speed=Math.max(0.2,Math.min(3,speed));};
window.onkeydown=e=>{
  const newCluster=new Cluster(phrases[Math.floor(Math.random()*phrases.length)]);
  // placer dans zone moins dense
  let tries=0;
  while(tries<10){
    let crowded=false;
    for(const c of clusters){
      if(Math.hypot(c.x-newCluster.x,c.y-newCluster.y)<100){crowded=true;break;}
    }
    if(!crowded) break;
    newCluster.x=Math.random()*W; newCluster.y=Math.random()*H;
    tries++;
  }
  clusters.push(newCluster);
};

// --- LOOP ---
function loop(){
  ctx.fillStyle=`rgba(${6+bgCorruption*50},${6+bgCorruption*20},${10+bgCorruption*80},0.12)`;
  ctx.fillRect(0,0,W,H);
  clusters.forEach(c=>c.update(clusters));
  clusters.forEach(c=>c.render());
  requestAnimationFrame(loop);
}
loop();

// --- RANDOM TITLE DYNAMIQUE ---
function randomTitle(){ 
  const titlePhrases=["Ne te trompe pas de porte","Tu es le paramètre","Il n’y a pas de dernière ligne","La porte est toujours là"];
  document.title=titlePhrases[Math.floor(Math.random()*titlePhrases.length)];
}
randomTitle();
setInterval(randomTitle, 8000); // change toutes les 8 secondes

</script>
</body>
</html>
